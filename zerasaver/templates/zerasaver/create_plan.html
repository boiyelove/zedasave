{% extends 'accounts/inside.html' %}

{% block inside_html %}
						{{ form.errors }}
						<form method="{{ form_method }}" action="{{ form_action }}">
							{% csrf_token %}
							<h3>Create a Savings Plan</h3>
							<hr>
							<h5>Choose the deposit to be saved into your Zerasave account. 
							 Your savings will be stopped as soon as you reach your target. <br>
							 You can change your target anytime.</h5>
							 <br>
							  <br>
								{{ form.errors }}
							 <br>
							 <div class="col-md-8">
							<div class="form-group">
								<label class="control-label">Frequency - How frequently do you want to deposit money?</label>
										<select name="frequency" id="id_frequency" class="form-control">
										  <option value="1" selected="">Daily</option>
										  <option value="2">Weekly</option>
										  <option value="3">Monthly</option>
										</select>
							</div>
							<br>
							<div class="form-group freq_choice" id="day_of_week_choice">
								<label class="control-label">What day of the Week?</label>
									<select name="day_of_week" id="id_day_of_week" class="form-control">
											  <option value="1" selected="">Monday</option>
											  <option value="2">Tuesday</option>
											  <option value="3">Wednesday</option>
											  <option value="4">Thursday</option>
											  <option value="5">Friday</option>
											  <option value="6">Saturday</option>
											  <option value="7">Sunday</option>
											</select>
								<br>
							</div>
							<div class="form-group freq_choice" id="day_of_month_choice">
								<label class="control-label">What day of the month?</label>
										<select name="day_of_month" id="id_day_of_month" class="form-control">
											  <option value="1" selected="">1st</option>
											  <option value="2">2nd</option>
											  <option value="3">3rd</option>
											  <option value="4">4th</option>
											  <option value="5">5th</option>
											  <option value="6">6th</option>
											  <option value="7">7th</option>
											  <option value="8">8th</option>
											  <option value="9">9th</option>
											  <option value="10">10th</option>
											  <option value="11">11th</option>
											  <option value="12">12th</option>
											  <option value="13">13th</option>
											  <option value="14">14th</option>
											  <option value="15">15th</option>
											  <option value="16">16th</option>
											  <option value="17">17th</option>
											  <option value="18">18th</option>
											  <option value="19">19th</option>
											  <option value="20">20th</option>
											  <option value="21">21st</option>
											  <option value="22">22nd</option>
											  <option value="23">23rd</option>
											  <option value="24">24th</option>
											  <option value="25">25th</option>
											  <option value="26">26th</option>
											  <option value="27">27th</option>
											  <option value="28">28th</option>
										</select>
								 <br>							  		
							 </div>
							<div class="form-group">
							  <label class="control-label">Choose the time of the day</label>
								<select name="deposit_time" id="id_deposit_time" class="form-control">
										<option selected="selected" value="1">04:00 am</option>
										<option value="2">04:30 am</option>
										<option value="3">05:00 am</option>
										<option value="4">05:30 am</option>
										<option value="5">06:00 am</option>
										<option value="6">06:30 am</option>
										<option value="7">07:00 am</option>
										<option value="8">07:30 am</option>
										<option value="9">08:00 am</option>
										<option value="10">08:30 am</option>
										<option value="11">09:00 am</option>
										<option value="12">09:30 am</option>
										<option value="13">10:00 am</option>
										<option value="14">10:30 am</option>
										<option value="15">11:00 am</option>
										<option value="16">11:30 am</option>
										<option value="17">12:00 pm</option>
										<option value="18">12:30 pm</option>
										<option value="19">01:00 pm</option>
										<option value="20">01:30 pm</option>
										<option value="21">02:00 pm</option>
										<option value="22">02:30 pm</option>
										<option value="23">03:00 pm</option>
										<option value="24">03:30 pm</option>
										<option value="25">04:00 pm</option>
										<option value="26">04:30 pm</option>
										<option value="27">05:00 pm</option>
										<option value="28">05:30 pm</option>
										<option value="29">06:00 pm</option>
										<option value="30">06:30 pm</option>
										<option value="31">07:00 pm</option>
										<option value="32">07:30 pm</option>
										<option value="33">08:00 pm</option>
										<option value="34">08:30 pm</option>
										<option value="35">09:00 pm</option>
										<option value="36">09:30 pm</option>
										<option value="37">10:00 pm</option>
										<option value="38">10:30 pm</option>
										<option value="39">11:00 pm</option>
										<option value="40">11:30 pm</option>
								</select>
							</div>
							<br>
							<div class="form-group">
							  <label for="">My daily deposit - How much can you afford to deposit daily? (between <span id="amount_limits">₦200 - ₦5000</span>) </label>
							  <input type="number" min-length="3" maxlength="6" id="id_amount" name="deposit_amount" class="form-control" required>
							</div>
							<div class="row text-right">
								<button id="amount_update_btn" class="btn btn-primary" >Estimate saving plan</button>
							</div>
							<br>
							<hr>
							<p class="row bg-info"><i class="fa fa-info-circle"></i> Please note that your savings plan will be paused as soon as your saving target is reached. 
							</p>
							<hr>
							<br>
							<div class="form-group" id="savings_target_choice"> 
								  <label>My Saving Target </label>

								  <select name="target" id="id_savings_target" class="form-control" required>
										

										</select>
								</div>
							<br>
							<div class="checkbox" id="id_iagree_div">
								<label class="control-label">
								<input type="checkbox" name="iagree" id='id_iagree' required>
									I hearby confirm and approve this savings plan, and I authorize iSave.ng to save me ₦<span id="id_min_amount"></span> daily using my debit card until I decide to cancel it, or when my target of ₦<span id="id_max_amount"></span> has been reached
								</label>
							</div>
							<br>
							<input id="id_submit_btn" type="submit" value="Start my saving plan" class="btn btn-lg col-md-12 btn-success">
							<br>
							</div>
						

						</form>
{% endblock %}


{% block extra_js %}
$('.freq_choice').hide();
$('#savings_target_choice').hide();
$('#id_iagree_div').hide();
$('#id_submit_btn').hide();
function updateLimits(min_val, max_val){
	$('#amount_limits').html('₦' + min_val + ' - ' + '₦' + max_val);
	$('#id_min_amount').html(min_val);
	$('#id_max_amount').html(max_val);
};
$('#id_frequency').change(function(){
	$('#savings_target_choice').hide();
	$('.freq_choice').hide();
		updateLimits(200, 500000);
		var val = $(this).val();
	if (val == '2'){
		updateLimits(1000, 500000);
		$('#day_of_week_choice').show();
	}
	if (val == '3'){
		updateLimits(5000, 500000);
		$('#day_of_month_choice').show();
	}
});
function updateSavingsPlan(event){
	e.preventDefault();
	console.log('Button Clicked');
}

function updateSavingsTarget(val, max_dur, dur, min_dur){
	var opstr;
	var total;

	console.log('in update Savings target',val, max_dur, dur, min_dur );
	$('#id_savings_target').empty();
	for (var i = min_dur; i < max_dur + min_dur;  i = i + min_dur){
		console.log(i);
		total = i * val;
		if (i == 2){
			opstr = "<option value='" + i + "' selected='selected'>₦" + total + " to be saved in " + i + dur + "</option>";
		} else {
				opstr = "<option value='" + i + "'>₦" + total + " to be saved in " + i + dur + "</option>";
				};
		$('#id_savings_target').append(opstr);
	};
	$('#savings_target_choice').show();

}

function validate_amount(val, min_val, max_val){
		if ((val >= min_val) && (val <= max_val)){
			return true;
		} else {
			alert("amount should be between " + min_val + " and " + max_val);
			if (val < min_val){
				alert(val + " is too small");
				} 
				else if (val > max_val){
					alert(val + " is too big");
				};
			return false;
		}
	}

$('#amount_update_btn').click(function(event){
	event.preventDefault();

	var selected_freq = $('#id_frequency').val();

	var val = parseInt($('#id_amount').val());

	if (selected_freq == 1){
		var dur = "Days";
		var max_dur = 800;
		var min_dur = 91;
		var min_val = 200;
		var max_val = 500000;
		if (validate_amount(val, min_val, max_val)){
			updateSavingsTarget(val, max_dur, dur, min_dur);
		}
	} else if (selected_freq == 2){

		var dur = "Weeks";
		var max_dur = 200;
		var min_dur = 9;
		var min_val = 1000;
		var max_val = 500000;
		if (validate_amount(val, min_val, max_val)){
			updateSavingsTarget(val, max_dur, dur, min_dur);
		};

	} else if (selected_freq == 3){

		var dur = "Months";
		var max_dur = 200;
		var min_dur = 2;
		var min_val = 5000;
		var max_val = 500000;
		if (validate_amount(val, min_val, max_val)){
			updateSavingsTarget(val, max_dur, dur, min_dur);
		};
	} else {

		alert("Invalid frequency value");

	}

});

$('#id_savings_target').change(function(){
	$('#id_iagree_div').fadeIn("slow");
});

$('#id_iagree').change(function(){
	if ($('#id_iagree').is(":checked")){
		$('#id_submit_btn').fadeIn("slow");
	} else {
		$('#id_submit_btn').fadeOut("slow");
	}
});
{% endblock %}